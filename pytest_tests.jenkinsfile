pipeline {
    agent any

    stages {
        stage('Prepare workspace') {
            steps {
               echo "Running ${env.BUILD_ID} ${env.BUILD_DISPLAY_NAME} on ${env.NODE_NAME} and JOB ${env.JOB_NAME}"
               echo "Start installing dependencies"
               sh "pip install -r requirements.txt"
            }
        }
        stage('Run tests') {
            steps {
                script {
                    echo "Start running test cases"
                    def test_results = sh (script: "pytest trn_db_tests.py -v", returnStatus: true)
                    echo "Status code: ${test_results}"
                }
            }
        }
        stage('Merge to production') {
            steps {
                echo 'Merging...'
            }
        }
    }
}